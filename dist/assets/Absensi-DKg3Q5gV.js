import{s as F}from"./index-BdlwmbEA.js";import{_ as M}from"./Vuelidate-D58-4aDa.js";import{s as O,b as B}from"./index-kMO2B_2Z.js";import{g,_ as H}from"./Default-rdowlBa5.js";import{_ as z,E as m,c as f,a as l,b as s,w as o,F as J,o as k,C as h,bX as A,t as N,l as T,v as D,s as Y}from"./index-IT0w0-03.js";import{s as q}from"./index-7h0g2jJM.js";import{s as $}from"./index-BZEh9QIP.js";import{s as W,a as X,b as Z,c as G,d as Q}from"./index-Cd4a2zSy.js";import{s as R}from"./index-J9SwwLSJ.js";import{_ as aa}from"./PageHeader-BmhK7qIL.js";import{s as ea}from"./index-D3TYj3W6.js";import{u as ta}from"./index-Cn83LMNj.js";import{r}from"./index-DhnhZP77.js";import{j as sa,a as ia,f as la,b as c,p as oa}from"./date-DaizdcBV.js";import"./index-Co2kFwYe.js";import"./index-D1kxKiUG.js";import"./index-D0k6Dizi.js";import"./index-BdwjZwyA.js";import"./index-CKMnAYYC.js";import"./index-Cg8qX79j.js";import"./index-RjTvz6_0.js";const na={name:"Absensi",inject:["default"],data(){return{isLoading:!1,inputIsLoading:!1,kodeAbsensi:"",loadingTable:!1,data:[],dataId:[],daftarHari:[],visible:!1,selectedTanggal:new Date,date:new Date,outline:!1,tanggal:"",postOrEdit:!1,pesan:!1,loadingPegawai:!0,dialogIsLoading:!1,columns:[{field:"nama_pegawai",header:"Nama Pegawai"},{field:"status",header:"Status"},{field:"jam_masuk",header:"Jam Masuk"},{field:"jam_keluar",header:"Jam Keluar"}],hasValidated:!1,v$:ta(),idKehadiran:"",dataStatus:"",status:[{name:"Hadir",code:"Hadir"},{name:"Terlambat",code:"Terlambat"},{name:"Izin",code:"Izin"},{name:"Tidak Hadir",code:"Tidak Hadir"}],pegawai:"",dataEditPegawai:"",daftarPegawai:null,phPegawai:"Loading...",kode_kehadiran:"",hari:"",tgl_kehadiran:"",jam_masuk:"",jam_keluar:"",extractVisible:!1}},validation(){return{dataStatus:{required:r},pegawai:{required:r},kode_kehadiran:{required:r},hari:{required:r},tgl_kehadiran:{required:r},jam_masuk:{required:r},jam_keluar:{required:r}}},watch:{date(e){this.selectedTanggal=this.formattedDate(e),this.created(this.selectedTanggal)}},methods:{justMonth:sa,justYear:ia,formattedDate:la,formatTimee:c,parseDate:oa,exToggle(){this.extractVisible=!this.extractVisible},exportExcel(e){this.$confirm.require({message:"Export Data Kehadiran Bulan "+this.justMonth(e)+" Tahun "+this.justYear(e)+"?",header:"Danger Zone",icon:"pi pi-info-circle",rejectProps:{label:"Batalkan",severity:"secondary",outlined:!0},acceptProps:{label:"Export",severity:"success"},accept:()=>{this.$toast.add({severity:"info",summary:"Data berhasil di export",detail:"Install data sekarang.",life:3e3});const a=this.justYear(e),n=this.justMonth(e),b=`http://api-absensi.eventpro.id/api/kehadiran/export/${a}/${n}`;window.location.href=b},reject:()=>{}}),console.log(this.justYear(e)),console.log(this.justMonth(e))},deleteAbsen(e,a,n){this.$confirm.require({target:e.currentTarget,message:"Apakah anda yakin ingin menghapus data ini?",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{this.onDelete(a,n)},reject:()=>{this.$toast.add({severity:"info",summary:"Data Tidak Dihapus",detail:"Data tidak dihapus",life:3e3})}})},async onDelete(e,a){try{const n=await m.delete(`kehadiran/${e}`);this.$toast.add({severity:"success",summary:"Success",detail:n.data.message,life:3e3}),this.created()}catch(n){console.log(n),this.$toast.add({severity:"error",summary:"Error",detail:n.data.message,life:3e3})}},async created(e){this.loadingTable=!0;try{this.data=e?await g(`/kehadiran?tgl_kehadiran=${e}`):await g("/kehadiran"),this.loadingTable=!1,console.log(this.data)}catch(a){console.error("Failed to fetch data:",a)}finally{this.loadingTable=!1}},async getPegawaiAll(){try{const e=await m.get("pegawai");this.daftarPegawai=e.data.data,this.loadingPegawai=!1,this.phPegawai="Pilih pegawai"}catch(e){console.log("Error:"+e),this.phPegawai="Error",this.loadingPegawai=!1}},async getId(e){try{this.dataId=await g(`/kehadiran/${e}`),this.pegawai=this.daftarPegawai.find(a=>a.id_pegawai===this.dataId.id_pegawai)||null,this.dataStatus=this.status.find(a=>a.code===this.dataId.status)||null,this.kode_kehadiran=this.dataId.kode_kehadiran,this.hari=this.dataId.hari,this.idKehadiran=this.dataId.id_kehadiran,this.tgl_kehadiran=this.parseDate(this.dataId.tgl_kehadiran),this.jam_masuk=this.dataId.jam_masuk,this.jam_keluar=this.dataId.jam_keluar}catch(a){console.error("Failed to fetch data:",a)}},async edit(e){this.hasValidated=!0;const a={id_kehadiran:this.dataId.id_kehadiran,id_pegawai:this.pegawai.id_pegawai,status:this.dataStatus.code,kode_kehadiran:this.kode_kehadiran,hari:this.hari,tgl_kehadiran:this.formattedDate(this.tgl_kehadiran),jam_masuk:c(this.jam_masuk)};this.jam_keluar&&(a.jam_keluar=c(this.jam_keluar)),await m.patch(`kehadiran/${e}`,a).then(n=>{console.log(n),this.created(this.selectedTanggal),this.$toast.add({severity:"success",summary:"Success",detail:n.data.message,life:3e3}),this.toggleVisible()}).catch(n=>{console.log(n),this.$toast.add({severity:"error",summary:"Error",detail:n,life:3e3}),this.pesan=!0,this.toggleVisible()}),this.hasValidated=!1},async post(){this.hasValidated=!0,this.tgl_kehadiran=this.date;const e={id_pegawai:this.pegawai.id_pegawai,status:this.dataStatus.code,kode_kehadiran:this.kode_kehadiran,hari:this.hari,tgl_kehadiran:this.formattedDate(this.tgl_kehadiran),jam_masuk:c(this.jam_masuk)};this.jam_keluar&&(e.jam_keluar=c(this.jam_keluar)),await m.post("kehadiran",e).then(a=>{console.log(a),this.created(),this.$toast.add({severity:"success",summary:"Success",detail:a.data.message,life:3e3})}).catch(a=>{this.pesan=!0,console.log(a),this.$toast.add({severity:"error",summary:"Error",detail:a,life:3e3})}),this.hasValidated=!1},async getPegawai(e){this.dataId=await g(`/pegawai/${e}`),this.pegawai=this.daftarPegawai.find(a=>a.id_pegawai===this.dataId.id_pegawai)||null,this.dataStatus="",this.kode_kehadiran="",this.hari="",this.tgl_kehadiran="",this.jam_masuk=this.dataId.jam_masuk,this.jam_keluar=this.dataId.jam_keluar},openForm(e,a){this.toggleVisible(),e=="-"?(this.postOrEdit=!0,this.getPegawai(a)):(this.postOrEdit=!1,this.getId(e))},toggleVisible(){this.visible=!this.visible,this.pesan=!1},async postKodeAbsensi(){const e={token:this.kodeAbsensi};await m.post("kehadiran/masuk/confirm",e).then(a=>{console.log(a),this.created(),this.kodeAbsensi="",this.$toast.add({severity:"success",summary:"Success",detail:a.data.message,life:3e3})}).catch(a=>{console.log(a),this.$toast.add({severity:"error",summary:"Error",detail:`${a.response.data.message}`,life:3e3}),this.kodeAbsensi=""})},async postKodeAbsensiKeluar(){const e={token:this.kodeAbsensi};await m.post("kehadiran/keluar/confirm",e).then(a=>{console.log(a),this.kodeAbsensi="",this.created(),this.$toast.add({severity:"success",summary:"Success",detail:a.data.message,life:3e3})}).catch(a=>{console.log(a),this.$toast.add({severity:"error",summary:"Error",detail:a.data.message,life:3e3}),this.kodeAbsensi=""})}},async mounted(){await this.created(),await this.getPegawaiAll()}},da={key:0,class:"grid grid-cols-12 gap-5 h-dvh m-5"},ra={class:"col-span-12 w-full flex justify-center items-center"},ma={key:1,class:"grid grid-cols-12 gap-5 m-5 mb-24 lg:mb-5"},ua={class:"flex flex-col"},ha={class:"flex flex-col"},ca={class:"mt-4 flex justify-between"},pa={class:"flex items-center gap-2"},ga={class:"w-full h-full text-center bg-transparent border-none p-0 m-0",style:{cursor:"pointer"}},_a={class:"flex gap-2 bg-white"},fa={class:"p-7 grid grid-cols-12 gap-2"},ka={class:"col-span-12 font-semibold text-red-500"},ba={class:"col-span-12 w-full gap-1"},wa={class:"col-span-12 w-full gap-1"},ya={class:"col-span-6 w-full gap-1"},va={class:"col-span-6 w-full gap-1"},xa={class:"col-span-12 w-full gap-1"},ja={class:"col-span-12 flex justify-end gap-2"};function Va(e,a,n,b,t,d){const w=ea,I=aa,y=W,E=X,v=R,x=Z,K=G,S=Q,j=$,p=q,u=Y,C=O,L=H,V=B,_=M,U=F;return k(),f(J,null,[t.isLoading?(k(),f("div",da,[l("div",ra,[s(w)])])):(k(),f("div",ma,[s(I,{title:"Absensi"}),s(j,{class:"col-span-12 shadow-md"},{title:o(()=>a[11]||(a[11]=[l("div",{class:"w-full text-center"},"Konfirmasi Absensi Pegawai",-1)])),content:o(()=>[s(S,{value:"0"},{default:o(()=>[s(E,null,{default:o(()=>[s(y,{value:"0"},{default:o(()=>a[12]||(a[12]=[h("Absen Masuk")])),_:1}),s(y,{value:"1"},{default:o(()=>a[13]||(a[13]=[h("Absen Keluar")])),_:1})]),_:1}),s(K,null,{default:o(()=>[s(x,{value:"0"},{default:o(()=>[l("div",ua,[s(v,{type:"text",modelValue:t.kodeAbsensi,"onUpdate:modelValue":a[0]||(a[0]=i=>t.kodeAbsensi=i),onKeydown:A(d.postKodeAbsensi,["enter"]),autofocus:""},null,8,["modelValue","onKeydown"])])]),_:1}),s(x,{value:"1"},{default:o(()=>[l("div",ha,[s(v,{type:"text",modelValue:t.kodeAbsensi,"onUpdate:modelValue":a[1]||(a[1]=i=>t.kodeAbsensi=i),onKeydown:A(d.postKodeAbsensiKeluar,["enter"]),autofocus:""},null,8,["modelValue","onKeydown"])])]),_:1})]),_:1})]),_:1})]),_:1}),s(j,{class:"col-span-12 shadow-md"},{title:o(()=>[a[15]||(a[15]=h(" Daftar Pegawai Telah Absen ")),l("div",ca,[l("div",pa,[a[14]||(a[14]=l("label",{for:"date",class:"font-semibold text-base mr-2"}," Data Absen Tanggal : ",-1)),s(p,{modelValue:t.date,"onUpdate:modelValue":a[2]||(a[2]=i=>t.date=i),name:"date",id:"date",view:"date",dateFormat:"dd/mm/yy",placeholder:"Pilih tanggal"},{date:o(i=>[l("button",ga,[l("strong",null,N(i.date.day),1)])]),_:1},8,["modelValue"]),T(s(w,{style:{width:"40px",height:"40px"},strokeWidth:"8","aria-label":"Loading"},null,512),[[D,t.loadingTable]])]),l("div",null,[s(u,{type:"button",label:"Export",class:"bg-green-500 border-green-500",onClick:a[3]||(a[3]=i=>d.exportExcel(t.date))})])])]),content:o(()=>[s(L,{columns:t.columns,api:"/kehadiran",id:"id_kehadiran",dataLuar:t.data,deleteAble:!1,cusAction:!0},{default:o(()=>[s(C,{header:"Action",frozen:"",alignFrozen:"right",style:{width:"100px"}},{body:o(i=>[l("div",_a,[s(u,{icon:"pi pi-pencil",severity:"info","aria-label":"Edit",onClick:P=>d.openForm(i.data.id_kehadiran,i.data.id_pegawai)},null,8,["onClick"]),s(u,{icon:"pi pi-trash",severity:"danger","aria-label":"Delete",onClick:P=>d.deleteAbsen(P,i.data.id_kehadiran,i.data.id_pegawai)},null,8,["onClick"])])]),_:1})]),_:1},8,["columns","dataLuar"])]),_:1})])),s(U,{visible:t.visible,"onUpdate:visible":a[10]||(a[10]=i=>t.visible=i),modal:"",style:{width:"40rem"}},{container:o(()=>[l("form",fa,[a[18]||(a[18]=l("p",{class:"col-span-12 text-xl mb-6 font-semibold"}," Edit Kehadiran Pegawai ",-1)),T(l("p",ka,"Isi Semua Input Data!",512),[[D,t.pesan]]),l("div",ba,[a[16]||(a[16]=l("label",{class:"max-h-6 col-span-12 mb-2",for:"pegawai"},[h("Pegawai "),l("span",{class:"text-red-500"},"*")],-1)),s(V,{disabled:"","input-id":"pegawai",name:"pegawai",modelValue:t.pegawai,"onUpdate:modelValue":a[4]||(a[4]=i=>t.pegawai=i),placeholder:"Pilih pegawai",options:t.daftarPegawai,optionLabel:"nama_lengkap",class:"w-full mb-3"},null,8,["modelValue","options"])]),l("div",wa,[a[17]||(a[17]=l("label",{class:"max-h-6 col-span-12 mb-2",for:"status"},[h("Status Kehadiran "),l("span",{class:"text-red-500"},"*")],-1)),s(V,{"input-id":"status",name:"status",modelValue:t.dataStatus,"onUpdate:modelValue":a[5]||(a[5]=i=>t.dataStatus=i),placeholder:"Pilih status kehadiran",options:t.status,optionLabel:"name",class:"w-full mb-3"},null,8,["modelValue","options"])]),l("div",ya,[s(_,{name:"jam_masuk",label:"Jam Masuk"},{default:o(()=>[s(p,{timeOnly:"","input-id":"jam_masuk",modelValue:t.jam_masuk,"onUpdate:modelValue":a[6]||(a[6]=i=>t.jam_masuk=i),placeholder:"Pilih jam masuk",class:"col-span-12 max-h-[46px]"},null,8,["modelValue"])]),_:1})]),l("div",va,[s(_,{name:"jam_keluar",label:"Jam Keluar"},{default:o(()=>[s(p,{timeOnly:"","input-id":"jam_keluar",modelValue:t.jam_keluar,"onUpdate:modelValue":a[7]||(a[7]=i=>t.jam_keluar=i),placeholder:"Pilih jam keluar",class:"col-span-12 max-h-[46px]"},null,8,["modelValue"])]),_:1})]),l("div",xa,[s(_,{name:"tgl_kehadiran",label:"Tanggal Kehadiran"},{default:o(()=>[s(p,{"input-id":"tgl_kehadiran",modelValue:t.tgl_kehadiran,"onUpdate:modelValue":a[8]||(a[8]=i=>t.tgl_kehadiran=i),placeholder:"Pilih tanggal kehadiran",options:t.tgl_kehadiran,optionLabel:"name",class:"col-span-12 max-h-[46px]"},null,8,["modelValue","options"])]),_:1})]),l("div",ja,[s(u,{type:"button",label:"Cancel",severity:"secondary",onClick:d.toggleVisible},null,8,["onClick"]),s(u,{type:"button",loading:t.dialogIsLoading,label:t.postOrEdit?"Tambahkan":"Edit",onClick:a[9]||(a[9]=i=>t.postOrEdit?d.post():d.edit(t.idKehadiran))},null,8,["loading","label"])])])]),_:1},8,["visible"])],64)}const $a=z(na,[["render",Va]]);export{$a as default};
